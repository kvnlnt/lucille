var Pickl=function(a){var b={};b.form={width:320,height:520},b.config=this.Fixture,b.svg=null,b.callback=function(a){console.log(a)},_.extend(this,b,a),this.render()};Pickl.prototype.Fixture=function(){var a={};return a.title="Options",a.colors={background:"#e2e2e2"},a.fieldsets=[{name:"Orientation",fields:[{name:"orientation",values:["righty","lefty"],selected:0}]},{name:"Instrument",fields:[{name:"instrument",values:["guitar","banjo","ukelele"],selected:0},{name:"strings",values:["5 string","6 string","7 string"],selected:1}]}],a}(),Pickl.prototype.render=function(){this.pickl=this.renderForm(),this.pickl.background=this.renderBackground(),this.pickl.title=this.renderTitle(),this.pickl.close=this.renderClose(),this.pickl.fieldsets=this.renderFieldsets()},Pickl.prototype.renderForm=function(){var a=null===this.svg?Snap(this.form.width,this.form.height):this.svg,b=a.attr("class")+" pickl";return a.attr({"class":b}),a},Pickl.prototype.renderBackground=function(){var a=this.pickl.rect(0,0,this.form.width,this.form.height);return a.attr({fill:this.config.colors.background}),a},Pickl.prototype.renderTitle=function(){var a=this.pickl.text(this.form.width/2,50,this.config.title);return a.attr({"class":"title"}),a},Pickl.prototype.renderClose=function(){{var a=this.pickl.g().attr("class","button close"),b=.15*this.form.width/2,c=this.form.height-70,d=.85*this.form.width,e=50;a.rect(b,c,d,e).attr({"class":"touchTarget"}),a.text(this.form.width/2,c+25,"close")}return a.click(this.save,this),a},Pickl.prototype.renderFieldsets=function(){var a=this,b=this.calcLayout(),c=this.pickl.g().attr("class","fieldsets");return _.each(this.config.fieldsets,function(d,e){{var f=b.fieldsets[e].x,g=b.fieldsets[e].y+100,h=c.g().attr({"class":"fieldset",transform:"translate("+f+","+g+")"});h.text(a.form.width/2,0,d.name)}_.each(d.fields,function(c,d){var f=b.fieldsets[e].fields[d].x,g=b.fieldsets[e].fields[d].y+20,i=b.fieldsets[e].fields[d].width,j=h.g().attr({"class":"button field",transform:"translate("+f+","+g+")"}),k=(j.rect(0,0,i,40).attr({"class":"touchTarget"}),j.text(i/2,20,c.values[c.selected]));j.click(function(){a.displayNext(c,k)},a)})}),c.selectAll(".fieldset")},Pickl.prototype.calcLayout=function(){var a={};return a.fieldsets=this.calcFieldsets(),a},Pickl.prototype.calcFieldsets=function(){var a=this,b=90,c=_.map(this.config.fieldsets,function(c,d){var e=.85*a.form.width/c.fields.length,f=.15*a.form.width/2,g=_.map(c.fields,function(a,b){return{width:e,x:f+e*b,y:0}});return{x:0,y:b*d,fields:g}});return c},Pickl.prototype.displayNext=function(a,b){var c=a.selected,d=a.values.length-1,e=c+1>d?0:c+1;a.selected=e,b.node.textContent=a.values[e]},Pickl.prototype.save=function(){var a={};_.each(this.config.fieldsets,function(b){_.each(b.fields,function(b){a[b.name]=b.values[b.selected]})}),this.callback(a),this.pickl.remove()};